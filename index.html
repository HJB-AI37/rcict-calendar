<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Professional Event Calendar</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');
        body { font-family: 'Inter', sans-serif; }
        .calendar-day:hover { transform: translateY(-2px); }
        .event-item { transition: all 0.3s ease; }
        .event-item:hover { transform: scale(1.02); }
        .gradient-bg { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .glass-effect { backdrop-filter: blur(10px); background: rgba(255, 255, 255, 0.9); }
        .drag-over { background: rgba(99, 102, 241, 0.1); border: 2px dashed #6366f1; }
        @keyframes slideIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .slide-in { animation: slideIn 0.3s ease-out; }
    </style>
</head>
<body class="bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-100 min-h-screen">
    <div class="container mx-auto px-4 py-6 max-w-7xl">
        <!-- Enhanced Header -->
        <div class="glass-effect rounded-3xl shadow-xl p-8 mb-8 border border-white/20">
            <div class="flex flex-col lg:flex-row items-start lg:items-center justify-between gap-6">
                <div>
                    <h1 class="text-4xl font-bold bg-gradient-to-r from-indigo-600 to-purple-600 bg-clip-text text-transparent mb-2">
                        RCICT Events & Training Calendar
                    </h1>
                    <p class="text-gray-600 text-lg">Manage workshops, training programs, and educational events</p>
                </div>
                
                <div class="flex flex-wrap items-center gap-4">
                    <!-- Navigation Controls -->
                    <div class="flex items-center space-x-2 bg-white/60 rounded-xl p-1">
                        <button onclick="previousMonth()" class="p-3 rounded-lg hover:bg-white/80 transition-all">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                            </svg>
                        </button>
                        <h2 id="currentMonth" class="text-xl font-semibold text-gray-700 min-w-48 text-center px-4"></h2>
                        <button onclick="nextMonth()" class="p-3 rounded-lg hover:bg-white/80 transition-all">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                            </svg>
                        </button>
                    </div>
                    
                    <!-- Action Buttons -->
                    <button onclick="goToToday()" class="px-6 py-3 bg-white/60 hover:bg-white/80 text-gray-700 rounded-xl font-medium transition-all">
                        Today
                    </button>
                    <button onclick="openAddEventModal()" class="px-6 py-3 gradient-bg text-white rounded-xl font-medium transition-all transform hover:scale-105 shadow-lg">
                        Add Event
                    </button>
                </div>
            </div>
            
            <!-- Quick Stats -->
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mt-6">
                <div class="bg-white/60 rounded-xl p-4 text-center">
                    <div class="text-2xl font-bold text-indigo-600" id="totalEvents">0</div>
                    <div class="text-sm text-gray-600">Total Events</div>
                </div>
                <div class="bg-white/60 rounded-xl p-4 text-center">
                    <div class="text-2xl font-bold text-green-600" id="todayEvents">0</div>
                    <div class="text-sm text-gray-600">Today's Events</div>
                </div>
                <div class="bg-white/60 rounded-xl p-4 text-center">
                    <div class="text-2xl font-bold text-orange-600" id="upcomingEvents">0</div>
                    <div class="text-sm text-gray-600">This Week</div>
                </div>
                <div class="bg-white/60 rounded-xl p-4 text-center">
                    <div class="text-2xl font-bold text-red-600" id="highPriorityEvents">0</div>
                    <div class="text-sm text-gray-600">Urgent Events</div>
                </div>
            </div>
        </div>

        <div class="grid grid-cols-1 xl:grid-cols-4 gap-8">
            <!-- Enhanced Calendar -->
            <div class="xl:col-span-3">
                <div class="glass-effect rounded-3xl shadow-xl p-6 border border-white/20">
                    <!-- Days of week header -->
                    <div class="grid grid-cols-7 gap-2 mb-6">
                        <div class="text-center font-bold text-gray-700 py-3 bg-gradient-to-r from-indigo-50 to-purple-50 rounded-xl">Sun</div>
                        <div class="text-center font-bold text-gray-700 py-3 bg-gradient-to-r from-indigo-50 to-purple-50 rounded-xl">Mon</div>
                        <div class="text-center font-bold text-gray-700 py-3 bg-gradient-to-r from-indigo-50 to-purple-50 rounded-xl">Tue</div>
                        <div class="text-center font-bold text-gray-700 py-3 bg-gradient-to-r from-indigo-50 to-purple-50 rounded-xl">Wed</div>
                        <div class="text-center font-bold text-gray-700 py-3 bg-gradient-to-r from-indigo-50 to-purple-50 rounded-xl">Thu</div>
                        <div class="text-center font-bold text-gray-700 py-3 bg-gradient-to-r from-indigo-50 to-purple-50 rounded-xl">Fri</div>
                        <div class="text-center font-bold text-gray-700 py-3 bg-gradient-to-r from-indigo-50 to-purple-50 rounded-xl">Sat</div>
                    </div>
                    
                    <!-- Calendar grid -->
                    <div id="calendarGrid" class="grid grid-cols-7 gap-3">
                        <!-- Calendar days will be generated here -->
                    </div>
                </div>
            </div>

            <!-- Enhanced Sidebar -->
            <div class="space-y-6">
                <!-- Upcoming Events -->
                <div class="glass-effect rounded-3xl shadow-xl p-6 border border-white/20">
                    <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                        <span>Upcoming Events</span>
                    </h3>
                    <div id="eventsList" class="space-y-3 max-h-96 overflow-y-auto">
                        <!-- Events will be displayed here -->
                    </div>
                </div>

                <!-- Categories Overview -->
                <div class="glass-effect rounded-3xl shadow-xl p-6 border border-white/20">
                    <h3 class="text-xl font-bold text-gray-800 mb-4">Event Categories</h3>
                    <div id="categoriesOverview" class="space-y-3">
                        <!-- Categories will be displayed here -->
                    </div>
                </div>

                <!-- Quick Actions -->
                <div class="glass-effect rounded-3xl shadow-xl p-6 border border-white/20">
                    <h3 class="text-xl font-bold text-gray-800 mb-4">Quick Actions</h3>
                    <div class="space-y-3">
                        <button onclick="openAddEventModal()" class="w-full p-3 bg-gradient-to-r from-blue-500 to-indigo-600 text-white rounded-xl hover:from-blue-600 hover:to-indigo-700 transition-all">
                            ➕ Add Event
                        </button>
                        <button onclick="exportCalendar()" class="w-full p-3 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-xl hover:from-green-600 hover:to-emerald-700 transition-all">
                            📄 Export Schedule
                        </button>
                        <button onclick="toggleToListView()" class="w-full p-3 bg-gradient-to-r from-purple-500 to-pink-600 text-white rounded-xl hover:from-purple-600 hover:to-pink-700 transition-all">
                            📋 List View
                        </button>
                        <button onclick="toggleToCalendarView()" class="w-full p-3 bg-gradient-to-r from-indigo-500 to-blue-600 text-white rounded-xl hover:from-indigo-600 hover:to-blue-700 transition-all">
                            📅 Calendar View
                        </button>
                    </div>
                </div>

                <!-- Data Management -->
                <div class="glass-effect rounded-3xl shadow-xl p-6 border border-white/20">
                    <h3 class="text-xl font-bold text-gray-800 mb-4">Data Management</h3>
                    <div class="space-y-3">
                        <button onclick="exportBackup()" class="w-full p-3 bg-gradient-to-r from-cyan-500 to-blue-600 text-white rounded-xl hover:from-cyan-600 hover:to-blue-700 transition-all">
                            💾 Download Backup
                        </button>
                        <label class="w-full p-3 bg-gradient-to-r from-orange-500 to-red-600 text-white rounded-xl hover:from-orange-600 hover:to-red-700 transition-all cursor-pointer block text-center">
                            📥 Import Backup
                            <input type="file" accept=".json" onchange="importBackup(event)" class="hidden">
                        </label>
                        <button onclick="saveEventsToStorage()" class="w-full p-3 bg-gradient-to-r from-teal-500 to-green-600 text-white rounded-xl hover:from-teal-600 hover:to-green-700 transition-all">
                            💾 Save Now
                        </button>
                        <button onclick="clearAllData()" class="w-full p-3 bg-gradient-to-r from-red-500 to-pink-600 text-white rounded-xl hover:from-red-600 hover:to-pink-700 transition-all">
                            🗑️ Clear All Data
                        </button>
                    </div>
                    <div class="mt-4 p-3 bg-blue-50 rounded-xl border border-blue-200">
                        <p class="text-xs text-blue-700 text-center">
                            💡 Your calendar automatically saves every change to your browser's local storage
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Date View Modal -->
    <div id="dateModal" class="fixed inset-0 bg-black/50 backdrop-blur-sm hidden items-center justify-center z-50 p-4">
        <div class="glass-effect rounded-3xl p-8 w-full max-w-4xl mx-4 border border-white/20 slide-in max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-6">
                <h3 id="dateModalTitle" class="text-2xl font-bold text-gray-800 flex items-center">
                    📅 <span class="ml-2">Events for [Date]</span>
                </h3>
                <button onclick="closeDateModal()" class="p-2 hover:bg-gray-100 rounded-xl transition-colors">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>
            
            <div id="dateEventsContainer" class="space-y-4 mb-6">
                <!-- Events for this date will be displayed here -->
            </div>
            
            <div class="border-t pt-6">
                <button onclick="openAddEventModal(); closeDateModal();" class="w-full px-6 py-4 gradient-bg text-white rounded-xl font-medium transition-all transform hover:scale-105 shadow-lg text-lg">
                    ➕ Add New Event to This Day
                </button>
            </div>
        </div>
    </div>

    <!-- Enhanced Add Event Modal -->
    <div id="addEventModal" class="fixed inset-0 bg-black/50 backdrop-blur-sm hidden items-center justify-center z-50 p-4">
        <div class="glass-effect rounded-3xl p-8 w-full max-w-2xl mx-4 border border-white/20 slide-in">
            <h3 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                <span>Create New Event</span>
            </h3>
            <form onsubmit="addEvent(event)" class="space-y-6">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Event Title</label>
                        <input type="text" id="eventTitle" required placeholder="Enter event name..." 
                               class="w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500">
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Event Type</label>
                        <select id="eventCategory" class="w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500">
                            <option value="workshop">Workshop</option>
                            <option value="seminar">Seminar</option>
                            <option value="certification">Certification Course</option>
                            <option value="webinar">Webinar</option>
                            <option value="conference">Conference</option>
                            <option value="bootcamp">Bootcamp</option>
                            <option value="meeting">Meeting</option>
                            <option value="training">Training Program</option>
                        </select>
                    </div>
                </div>

                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">Event Description</label>
                    <textarea id="eventDescription" rows="3" placeholder="Add event details, objectives, requirements..." 
                              class="w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"></textarea>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Start Date</label>
                        <input type="date" id="eventStartDate" required 
                               class="w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500">
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">End Date</label>
                        <input type="date" id="eventEndDate" 
                               class="w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500">
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Event Time</label>
                        <input type="time" id="eventTime" 
                               class="w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500">
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Urgency Level</label>
                        <select id="eventPriority" class="w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500">
                            <option value="low">Low - Optional</option>
                            <option value="medium">Medium - Important</option>
                            <option value="high">High - Urgent</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Color Theme</label>
                        <div class="flex space-x-2 pt-2">
                            <button type="button" onclick="selectColor('bg-blue-500')" class="w-10 h-10 bg-blue-500 rounded-full border-2 border-transparent hover:border-gray-400 transition-all"></button>
                            <button type="button" onclick="selectColor('bg-green-500')" class="w-10 h-10 bg-green-500 rounded-full border-2 border-transparent hover:border-gray-400 transition-all"></button>
                            <button type="button" onclick="selectColor('bg-red-500')" class="w-10 h-10 bg-red-500 rounded-full border-2 border-transparent hover:border-gray-400 transition-all"></button>
                            <button type="button" onclick="selectColor('bg-purple-500')" class="w-10 h-10 bg-purple-500 rounded-full border-2 border-transparent hover:border-gray-400 transition-all"></button>
                            <button type="button" onclick="selectColor('bg-yellow-500')" class="w-10 h-10 bg-yellow-500 rounded-full border-2 border-transparent hover:border-gray-400 transition-all"></button>
                            <button type="button" onclick="selectColor('bg-pink-500')" class="w-10 h-10 bg-pink-500 rounded-full border-2 border-transparent hover:border-gray-400 transition-all"></button>
                        </div>
                    </div>
                </div>

                <div class="flex space-x-4 pt-4">
                    <button type="button" onclick="closeAddEventModal()" 
                            class="flex-1 px-6 py-3 border border-gray-300 text-gray-700 rounded-xl hover:bg-gray-50 transition-all font-medium">
                        Cancel
                    </button>
                    <button type="submit" 
                            class="flex-1 px-6 py-3 gradient-bg text-white rounded-xl hover:shadow-lg transition-all font-medium transform hover:scale-105">
                        Create Event
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script>
        let currentDate = new Date();
        
        // Load events from localStorage or use sample data
        let events = loadEventsFromStorage() || [
            { id: 1, title: "Leadership Development Workshop", startDate: getTodayDate(), endDate: "", time: "10:00", color: "bg-blue-500", category: "workshop", priority: "high", description: "Essential leadership skills for team managers and supervisors" },
            { id: 2, title: "Digital Marketing Certification", startDate: getDateOffset(5), endDate: getDateOffset(7), time: "09:00", color: "bg-red-500", category: "certification", priority: "high", description: "Complete certification program covering SEO, social media, and analytics" },
            { id: 3, title: "Project Management Seminar", startDate: getDateOffset(10), endDate: "", time: "14:00", color: "bg-green-500", category: "seminar", priority: "medium", description: "Advanced project management techniques and methodologies" },
            { id: 4, title: "AI in Business Webinar Series", startDate: getDateOffset(13), endDate: getDateOffset(15), time: "15:00", color: "bg-yellow-500", category: "webinar", priority: "low", description: "Three-day webinar series on implementing AI solutions in business" },
            { id: 5, title: "Data Science Bootcamp", startDate: getDateOffset(3), endDate: getDateOffset(10), time: "09:00", color: "bg-purple-500", category: "bootcamp", priority: "medium", description: "Intensive 8-day bootcamp covering Python, machine learning, and data visualization" }
        ];

        // Storage functions
        function saveEventsToStorage() {
            try {
                localStorage.setItem('rcict_calendar_events', JSON.stringify(events));
                localStorage.setItem('rcict_calendar_last_saved', new Date().toISOString());
                showSaveNotification('✅ Calendar saved automatically');
            } catch (error) {
                console.error('Failed to save events:', error);
                showSaveNotification('⚠️ Failed to save calendar', 'error');
            }
        }

        function loadEventsFromStorage() {
            try {
                const savedEvents = localStorage.getItem('rcict_calendar_events');
                if (savedEvents) {
                    const parsedEvents = JSON.parse(savedEvents);
                    const lastSaved = localStorage.getItem('rcict_calendar_last_saved');
                    if (lastSaved) {
                        const savedDate = new Date(lastSaved).toLocaleDateString();
                        showSaveNotification(`📅 Calendar loaded from ${savedDate}`);
                    }
                    return parsedEvents;
                }
            } catch (error) {
                console.error('Failed to load events:', error);
                showSaveNotification('⚠️ Failed to load saved calendar', 'error');
            }
            return null;
        }

        function showSaveNotification(message, type = 'success') {
            // Remove existing notification
            const existingNotification = document.getElementById('saveNotification');
            if (existingNotification) {
                existingNotification.remove();
            }

            // Create notification
            const notification = document.createElement('div');
            notification.id = 'saveNotification';
            notification.className = `fixed top-4 right-4 z-50 px-6 py-3 rounded-xl shadow-lg transition-all transform translate-x-full ${
                type === 'error' ? 'bg-red-500 text-white' : 'bg-green-500 text-white'
            }`;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            // Animate in
            setTimeout(() => {
                notification.classList.remove('translate-x-full');
            }, 100);
            
            // Animate out and remove
            setTimeout(() => {
                notification.classList.add('translate-x-full');
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.remove();
                    }
                }, 300);
            }, 3000);
        }

        function clearAllData() {
            if (confirm('⚠️ This will permanently delete ALL your events and calendar data. This action cannot be undone.\n\nAre you sure you want to continue?')) {
                localStorage.removeItem('rcict_calendar_events');
                localStorage.removeItem('rcict_calendar_last_saved');
                events = [];
                renderCalendar();
                showSaveNotification('🗑️ All calendar data cleared');
            }
        }

        function exportBackup() {
            const backupData = {
                events: events,
                exportDate: new Date().toISOString(),
                version: '1.0'
            };
            
            const dataStr = JSON.stringify(backupData, null, 2);
            const blob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `RCICT_Calendar_Backup_${new Date().toISOString().split('T')[0]}.json`;
            
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
            
            showSaveNotification('💾 Backup file downloaded');
        }

        function importBackup(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const backupData = JSON.parse(e.target.result);
                    
                    if (backupData.events && Array.isArray(backupData.events)) {
                        if (confirm(`Import ${backupData.events.length} events from backup?\n\nThis will replace your current calendar data.`)) {
                            events = backupData.events;
                            saveEventsToStorage();
                            renderCalendar();
                            showSaveNotification(`📥 Imported ${backupData.events.length} events successfully`);
                        }
                    } else {
                        showSaveNotification('⚠️ Invalid backup file format', 'error');
                    }
                } catch (error) {
                    console.error('Import error:', error);
                    showSaveNotification('⚠️ Failed to import backup file', 'error');
                }
            };
            reader.readAsText(file);
            
            // Reset file input
            event.target.value = '';
        }

        let selectedColor = "bg-blue-500";
        let draggedEvent = null;

        function getTodayDate() {
            return new Date().toISOString().split('T')[0];
        }

        function getDateOffset(days) {
            const date = new Date();
            date.setDate(date.getDate() + days);
            return date.toISOString().split('T')[0];
        }

        function getCategoryIcon(category) {
            const icons = {
                workshop: "🛠️", 
                seminar: "🎓", 
                certification: "📜", 
                webinar: "💻", 
                conference: "🏢", 
                bootcamp: "⚡",
                meeting: "🤝",
                training: "📚"
            };
            return icons[category] || "📚";
        }

        function getPriorityColor(priority) {
            const colors = {
                high: "border-l-4 border-red-500",
                medium: "border-l-4 border-yellow-500", 
                low: "border-l-4 border-green-500"
            };
            return colors[priority] || "";
        }

        function updateStats() {
            const today = getTodayDate();
            const weekFromNow = getDateOffset(7);
            
            document.getElementById('totalEvents').textContent = events.length;
            document.getElementById('todayEvents').textContent = events.filter(e => e.startDate === today).length;
            document.getElementById('upcomingEvents').textContent = events.filter(e => e.startDate >= today && e.startDate <= weekFromNow).length;
            document.getElementById('highPriorityEvents').textContent = events.filter(e => e.priority === 'high').length;
        }

        function renderCalendar() {
            const year = currentDate.getFullYear();
            const month = currentDate.getMonth();
            
            const monthNames = ["January", "February", "March", "April", "May", "June",
                "July", "August", "September", "October", "November", "December"];
            document.getElementById('currentMonth').textContent = `${monthNames[month]} ${year}`;

            const firstDay = new Date(year, month, 1).getDay();
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            const daysInPrevMonth = new Date(year, month, 0).getDate();

            const calendarGrid = document.getElementById('calendarGrid');
            calendarGrid.innerHTML = '';

            // Previous month's trailing days
            for (let i = firstDay - 1; i >= 0; i--) {
                const day = daysInPrevMonth - i;
                const dayElement = createDayElement(day, true, year, month - 1);
                calendarGrid.appendChild(dayElement);
            }

            // Current month's days
            for (let day = 1; day <= daysInMonth; day++) {
                const dayElement = createDayElement(day, false, year, month);
                calendarGrid.appendChild(dayElement);
            }

            // Next month's leading days
            const totalCells = calendarGrid.children.length;
            const remainingCells = 42 - totalCells;
            for (let day = 1; day <= remainingCells; day++) {
                const dayElement = createDayElement(day, true, year, month + 1);
                calendarGrid.appendChild(dayElement);
            }

            renderEventsList();
            renderCategoriesOverview();
            updateStats();
        }

        function createDayElement(day, isOtherMonth, year, month) {
            const dayElement = document.createElement('div');
            const dateString = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
            const isToday = dateString === getTodayDate();
            
            const dayEvents = events.filter(event => {
                const eventStart = new Date(event.startDate);
                const eventEnd = event.endDate ? new Date(event.endDate) : new Date(event.startDate);
                const currentDay = new Date(dateString);
                return currentDay >= eventStart && currentDay <= eventEnd;
            });
            
            dayElement.className = `calendar-day relative p-3 h-32 border-2 rounded-2xl cursor-pointer transition-all ${
                isOtherMonth ? 'text-gray-400 bg-gray-50/50 border-gray-100' : 
                isToday ? 'bg-gradient-to-br from-indigo-100 to-purple-100 border-indigo-300 shadow-lg' :
                'bg-white/60 border-gray-200 hover:bg-white/80 hover:border-indigo-200 hover:shadow-md'
            }`;
            
            // Drag and drop functionality
            dayElement.addEventListener('dragover', (e) => {
                e.preventDefault();
                dayElement.classList.add('drag-over');
            });
            
            dayElement.addEventListener('dragleave', () => {
                dayElement.classList.remove('drag-over');
            });
            
            dayElement.addEventListener('drop', (e) => {
                e.preventDefault();
                dayElement.classList.remove('drag-over');
                if (draggedEvent && !isOtherMonth) {
                    moveEvent(draggedEvent.id, dateString);
                }
            });
            
            dayElement.addEventListener('click', () => {
                if (!isOtherMonth) {
                    openDateModal(dateString, dayEvents);
                }
            });
            
            dayElement.innerHTML = `
                <div class="flex justify-between items-start mb-2">
                    <div class="font-bold ${isOtherMonth ? 'text-gray-400' : isToday ? 'text-indigo-700' : 'text-gray-700'} text-lg">
                        ${day}
                    </div>
                    ${isToday ? '<div class="w-2 h-2 bg-indigo-500 rounded-full"></div>' : ''}
                </div>
                <div class="space-y-1 overflow-hidden">
                    ${dayEvents.slice(0, 3).map(event => {
                        const displayTitle = event.title.length > 10 ? event.title.substring(0, 10) + '...' : event.title;
                        return `
                            <div draggable="true" 
                                 ondragstart="handleDragStart(event, ${event.id})"
                                 onclick="event.stopPropagation(); showEventDetails(${event.id})"
                                 class="group relative text-xs px-2 py-1 ${event.color} text-white rounded-lg font-medium cursor-pointer event-item ${getPriorityColor(event.priority)} hover:scale-105 transition-all" 
                                 title="${event.title} - ${event.description}"
                                 style="z-index: 10; position: relative;">
                                <div class="flex items-center justify-between">
                                    <span class="truncate flex-1 mr-1">${displayTitle}</span>
                                    <button onclick="event.stopPropagation(); deleteEventFromDate(${event.id}, '${dateString}')" 
                                            class="opacity-70 hover:opacity-100 group-hover:opacity-100 w-4 h-4 bg-red-600 hover:bg-red-700 text-white rounded-full text-xs flex items-center justify-center transition-all cursor-pointer flex-shrink-0"
                                            style="pointer-events: auto; position: relative; z-index: 20;">×</button>
                                </div>
                            </div>
                        `;
                    }).join('')}
                    ${dayEvents.length > 3 ? `<div class="text-xs text-gray-500 text-center">+${dayEvents.length - 3} more</div>` : ''}
                </div>
                ${!isOtherMonth ? `<div class="absolute inset-0 flex items-center justify-center opacity-0 hover:opacity-100 transition-opacity bg-black/10 rounded-2xl" style="z-index: 5;">
                    <button onclick="event.stopPropagation(); openAddEventModal('${dateString}')" class="text-xs text-indigo-600 font-medium bg-white/95 px-3 py-1 rounded-lg shadow-lg hover:bg-white transition-all border border-indigo-200">
                        ${dayEvents.length === 0 ? '+ Add Event' : '+ Add Another Event'}
                    </button>
                </div>` : ''}
            `;

            return dayElement;
        }

        function handleDragStart(e, eventId) {
            draggedEvent = events.find(event => event.id === eventId);
            e.dataTransfer.effectAllowed = 'move';
        }

        function moveEvent(eventId, newDate) {
            const event = events.find(e => e.id === eventId);
            if (event) {
                const oldStart = new Date(event.startDate);
                const newStart = new Date(newDate);
                const dayDiff = (newStart - oldStart) / (1000 * 60 * 60 * 24);
                
                event.startDate = newDate;
                if (event.endDate) {
                    const newEnd = new Date(event.endDate);
                    newEnd.setDate(newEnd.getDate() + dayDiff);
                    event.endDate = newEnd.toISOString().split('T')[0];
                }
                saveEventsToStorage(); // Auto-save
                renderCalendar();
            }
        }

        function renderEventsList() {
            const eventsList = document.getElementById('eventsList');
            
            const sortedEvents = events
                .sort((a, b) => {
                    const priorityOrder = { high: 3, medium: 2, low: 1 };
                    if (priorityOrder[a.priority] !== priorityOrder[b.priority]) {
                        return priorityOrder[b.priority] - priorityOrder[a.priority];
                    }
                    return new Date(a.startDate + ' ' + (a.time || '00:00')) - new Date(b.startDate + ' ' + (b.time || '00:00'));
                })
                .slice(0, 8);

            if (sortedEvents.length === 0) {
                eventsList.innerHTML = '<div class="text-center py-8"><div class="text-4xl mb-2">📭</div><p class="text-gray-500">No events found</p></div>';
                return;
            }

            eventsList.innerHTML = sortedEvents.map(event => {
                const startDate = new Date(event.startDate);
                const endDate = event.endDate ? new Date(event.endDate) : null;
                
                let dateDisplay;
                if (endDate && endDate.getTime() !== startDate.getTime()) {
                    const formattedStart = startDate.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
                    const formattedEnd = endDate.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
                    dateDisplay = `${formattedStart} - ${formattedEnd}`;
                } else {
                    dateDisplay = startDate.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
                }
                
                return `
                    <div class="group p-4 bg-white/60 rounded-2xl border border-gray-200 hover:bg-white/80 hover:shadow-lg transition-all ${getPriorityColor(event.priority)}">
                        <div class="flex items-start justify-between">
                            <div class="flex-1">
                                <div class="flex items-center space-x-2 mb-1">
                                    <span class="font-semibold text-gray-800">${event.title}</span>
                                    <span class="text-xs px-2 py-1 ${event.color} text-white rounded-full">${event.priority}</span>
                                </div>
                                <p class="text-sm text-gray-600 mb-2">${event.description}</p>
                                <div class="text-sm text-gray-500">
                                    📅 ${dateDisplay}${event.time ? ` • ⏰ ${event.time}` : ''}
                                </div>
                            </div>
                            <button onclick="deleteEventCompletely(${event.id})" 
                                    class="opacity-0 group-hover:opacity-100 p-2 text-red-500 hover:bg-red-50 rounded-lg transition-all">
                                🗑️
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function renderCategoriesOverview() {
            const categoriesOverview = document.getElementById('categoriesOverview');
            const categoryCount = {};
            
            events.forEach(event => {
                categoryCount[event.category] = (categoryCount[event.category] || 0) + 1;
            });

            const categories = Object.entries(categoryCount).map(([category, count]) => ({
                category, count, icon: getCategoryIcon(category)
            }));

            if (categories.length === 0) {
                categoriesOverview.innerHTML = '<p class="text-gray-500 text-center">No categories yet</p>';
                return;
            }

            categoriesOverview.innerHTML = categories.map(({ category, count, icon }) => `
                <div class="flex items-center justify-between p-3 bg-white/60 rounded-xl border border-gray-200">
                    <div class="flex items-center space-x-3">
                        <span class="text-xl">${icon}</span>
                        <span class="font-medium text-gray-700 capitalize">${category}</span>
                    </div>
                    <span class="bg-indigo-100 text-indigo-800 px-2 py-1 rounded-full text-sm font-medium">${count}</span>
                </div>
            `).join('');
        }

        // Navigation functions
        function previousMonth() {
            currentDate.setMonth(currentDate.getMonth() - 1);
            saveEventsToStorage(); // Auto-save
            renderCalendar();
        }

        function nextMonth() {
            currentDate.setMonth(currentDate.getMonth() + 1);
            saveEventsToStorage(); // Auto-save
            renderCalendar();
        }

        function goToToday() {
            currentDate = new Date();
            saveEventsToStorage(); // Auto-save
            renderCalendar();
        }

        // Modal functions
        function openDateModal(selectedDate, dayEvents) {
            const dateObj = new Date(selectedDate);
            const formattedDate = dateObj.toLocaleDateString('en-US', { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            });
            
            document.getElementById('dateModalTitle').innerHTML = `📅 <span class="ml-2">Events for ${formattedDate}</span>`;
            
            const container = document.getElementById('dateEventsContainer');
            
            if (dayEvents.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-12">
                        <div class="text-6xl mb-4">📭</div>
                        <p class="text-xl text-gray-500 mb-4">No events scheduled for this day</p>
                        <p class="text-gray-400">Click "Add Event" below to create your first event</p>
                    </div>
                `;
            } else {
                container.innerHTML = dayEvents.map(event => {
                    const startDate = new Date(event.startDate);
                    const endDate = event.endDate ? new Date(event.endDate) : null;
                    
                    let dateDisplay;
                    if (endDate && endDate.getTime() !== startDate.getTime()) {
                        const formattedStart = startDate.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
                        const formattedEnd = endDate.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
                        dateDisplay = `${formattedStart} - ${formattedEnd}`;
                    } else {
                        dateDisplay = startDate.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
                    }
                    
                    return `
                        <div class="group p-6 bg-white/80 rounded-2xl border-2 border-gray-200 hover:border-indigo-300 hover:shadow-lg transition-all ${getPriorityColor(event.priority)}">
                            <div class="flex items-start justify-between">
                                <div class="flex-1">
                                    <div class="flex items-center space-x-3 mb-3">
                                        <span class="text-2xl">${getCategoryIcon(event.category)}</span>
                                        <div>
                                            <h4 class="text-xl font-bold text-gray-800">${event.title}</h4>
                                            <div class="flex items-center space-x-2 mt-1">
                                                <span class="text-sm px-3 py-1 ${event.color} text-white rounded-full font-medium">${event.category}</span>
                                                <span class="text-sm px-3 py-1 ${event.priority === 'high' ? 'bg-red-100 text-red-800' : event.priority === 'medium' ? 'bg-yellow-100 text-yellow-800' : 'bg-green-100 text-green-800'} rounded-full font-medium">${event.priority} priority</span>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    ${event.description ? `<p class="text-gray-600 mb-3 text-lg">${event.description}</p>` : ''}
                                    
                                    <div class="flex items-center space-x-4 text-gray-500">
                                        <div class="flex items-center space-x-2">
                                            <span class="text-lg">📅</span>
                                            <span class="font-medium">${dateDisplay}</span>
                                        </div>
                                        ${event.time ? `
                                            <div class="flex items-center space-x-2">
                                                <span class="text-lg">⏰</span>
                                                <span class="font-medium">${event.time}</span>
                                            </div>
                                        ` : ''}
                                    </div>
                                </div>
                                
                                <div class="flex space-x-2 opacity-100 transition-opacity">
                                    <button onclick="editEvent(${event.id}); closeDateModal();" class="p-3 bg-blue-100 text-blue-600 rounded-xl hover:bg-blue-200 transition-colors cursor-pointer" title="Edit Event">
                                        ✏️
                                    </button>
                                    <button onclick="deleteEventCompletely(${event.id})" class="p-3 bg-red-100 text-red-600 rounded-xl hover:bg-red-200 transition-colors" title="Delete Event">
                                        🗑️
                                    </button>
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');
            }
            
            // Store selected date for add event functionality
            window.selectedDateForNewEvent = selectedDate;
            
            document.getElementById('dateModal').classList.remove('hidden');
            document.getElementById('dateModal').classList.add('flex');
        }

        function closeDateModal() {
            document.getElementById('dateModal').classList.add('hidden');
            document.getElementById('dateModal').classList.remove('flex');
        }

        function openAddEventModal(selectedDate = null) {
            const modal = document.getElementById('addEventModal');
            if (!modal) return;
            
            modal.classList.remove('hidden');
            modal.classList.add('flex');
            
            const dateToUse = selectedDate || window.selectedDateForNewEvent || getTodayDate();
            const startDateInput = document.getElementById('eventStartDate');
            if (startDateInput) {
                startDateInput.value = dateToUse;
            }
            
            // Reset form to add mode
            resetModalForAdd();
        }

        function closeAddEventModal() {
            document.getElementById('addEventModal').classList.add('hidden');
            document.getElementById('addEventModal').classList.remove('flex');
            // Reset form
            document.getElementById('eventTitle').value = '';
            document.getElementById('eventDescription').value = '';
            document.getElementById('eventStartDate').value = '';
            document.getElementById('eventEndDate').value = '';
            document.getElementById('eventTime').value = '';
            document.getElementById('eventCategory').value = 'workshop';
            document.getElementById('eventPriority').value = 'low';
            selectedColor = 'bg-blue-500';
            
            // Reset modal for add mode
            resetModalForAdd();
        }

        function selectColor(color) {
            selectedColor = color;
            document.querySelectorAll('[onclick^="selectColor"]').forEach(btn => {
                btn.classList.remove('border-gray-800', 'scale-110');
                btn.classList.add('border-transparent');
            });
            event.target.classList.remove('border-transparent');
            event.target.classList.add('border-gray-800', 'scale-110');
        }

        function addEvent(e) {
            e.preventDefault();
            
            const titleInput = document.getElementById('eventTitle');
            const startDateInput = document.getElementById('eventStartDate');
            
            if (!titleInput || !startDateInput) {
                alert('Required fields are missing');
                return;
            }
            
            if (!titleInput.value.trim()) {
                alert('Please enter an event title');
                titleInput.focus();
                return;
            }
            
            if (!startDateInput.value) {
                alert('Please select a start date');
                startDateInput.focus();
                return;
            }
            
            const newId = Math.max(...events.map(e => e.id), 0) + 1;
            
            const newEvent = {
                id: newId,
                title: titleInput.value.trim(),
                description: document.getElementById('eventDescription').value.trim(),
                startDate: startDateInput.value,
                endDate: document.getElementById('eventEndDate').value,
                time: document.getElementById('eventTime').value,
                category: document.getElementById('eventCategory').value,
                priority: document.getElementById('eventPriority').value,
                color: selectedColor
            };
            
            events.push(newEvent);
            saveEventsToStorage();
            renderCalendar();
            closeAddEventModal();
        }

        function deleteEventFromCalendar(eventId) {
            const event = events.find(e => e.id === eventId);
            if (!event) return;
            
            if (confirm(`Delete "${event.title}"?`)) {
                events = events.filter(e => e.id !== eventId);
                saveEventsToStorage();
                renderCalendar();
            }
        }

        function deleteEventCompletely(eventId) {
            events = events.filter(e => e.id !== eventId);
            saveEventsToStorage();
            renderCalendar();
            
            // Close any open modals
            if (!document.getElementById('dateModal').classList.contains('hidden')) {
                closeDateModal();
            }
            
            // Close any event details modals
            const detailsModal = document.querySelector('.fixed.inset-0.bg-black\\/50');
            if (detailsModal) {
                detailsModal.remove();
            }
        }

        function deleteEventFromDate(eventId, dateString) {
            const event = events.find(e => e.id === eventId);
            if (!event) return;

            const eventStart = new Date(event.startDate);
            const eventEnd = event.endDate ? new Date(event.endDate) : new Date(event.startDate);
            const deleteDate = new Date(dateString);

            // If it's a single-day event, delete the entire event
            if (!event.endDate || eventStart.getTime() === eventEnd.getTime()) {
                events = events.filter(e => e.id !== eventId);
                saveEventsToStorage();
                renderCalendar();
                return;
            }

            // For multi-day events, remove from specific date only
            if (deleteDate.getTime() === eventStart.getTime()) {
                // Removing from start date - move start date forward
                const newStartDate = new Date(deleteDate);
                newStartDate.setDate(newStartDate.getDate() + 1);
                event.startDate = newStartDate.toISOString().split('T')[0];
            } else if (deleteDate.getTime() === eventEnd.getTime()) {
                // Removing from end date - move end date backward
                const newEndDate = new Date(deleteDate);
                newEndDate.setDate(newEndDate.getDate() - 1);
                event.endDate = newEndDate.toISOString().split('T')[0];
            } else {
                // Removing from middle - split the event into two parts
                const originalEndDate = new Date(event.endDate);
                
                // First part: from original start to day before delete date
                const firstPartEndDate = new Date(deleteDate);
                firstPartEndDate.setDate(firstPartEndDate.getDate() - 1);
                event.endDate = firstPartEndDate.toISOString().split('T')[0];
                
                // Second part: from day after delete date to original end
                const secondPartStartDate = new Date(deleteDate);
                secondPartStartDate.setDate(secondPartStartDate.getDate() + 1);
                
                const newId = Math.max(...events.map(e => e.id), 0) + 1;
                events.push({
                    id: newId,
                    title: event.title,
                    description: event.description,
                    startDate: secondPartStartDate.toISOString().split('T')[0],
                    endDate: originalEndDate.toISOString().split('T')[0],
                    time: event.time,
                    category: event.category,
                    priority: event.priority,
                    color: event.color
                });
            }
            saveEventsToStorage();
            renderCalendar();
        }

        function deleteEventFromModal(eventId, selectedDate) {
            const event = events.find(e => e.id === eventId);
            if (!event) return;

            const eventStart = new Date(event.startDate);
            const eventEnd = event.endDate ? new Date(event.endDate) : new Date(event.startDate);
            const deleteDate = new Date(selectedDate);

            // If it's a single-day event, delete the entire event
            if (!event.endDate || eventStart.getTime() === eventEnd.getTime()) {
                if (confirm(`Delete "${event.title}" completely?`)) {
                    events = events.filter(e => e.id !== eventId);
                    saveEventsToStorage();
                    renderCalendar();
                    closeDateModal();
                }
                return;
            }

            // For multi-day events, show a better dialog
            const deleteModal = document.createElement('div');
            deleteModal.className = 'fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4';
            deleteModal.innerHTML = `
                <div class="glass-effect rounded-3xl p-8 w-full max-w-md mx-4 border border-white/20 slide-in">
                    <h3 class="text-xl font-bold text-gray-800 mb-4">Delete Multi-Day Event</h3>
                    <p class="text-gray-600 mb-6">"${event.title}" spans multiple days. What would you like to do?</p>
                    <div class="space-y-3">
                        <button onclick="handleModalDelete(${eventId}, '${selectedDate}', 'specific')" 
                                class="w-full p-3 bg-blue-500 hover:bg-blue-600 text-white rounded-xl transition-all">
                            Remove from ${deleteDate.toLocaleDateString()} only
                        </button>
                        <button onclick="handleModalDelete(${eventId}, '${selectedDate}', 'all')" 
                                class="w-full p-3 bg-red-500 hover:bg-red-600 text-white rounded-xl transition-all">
                            Delete entire event from all dates
                        </button>
                        <button onclick="this.closest('.fixed').remove()" 
                                class="w-full p-3 bg-gray-300 hover:bg-gray-400 text-gray-700 rounded-xl transition-all">
                            Cancel
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(deleteModal);
        }

        function handleModalDelete(eventId, selectedDate, action) {
            const event = events.find(e => e.id === eventId);
            if (!event) return;

            const eventStart = new Date(event.startDate);
            const eventEnd = event.endDate ? new Date(event.endDate) : new Date(event.startDate);
            const deleteDate = new Date(selectedDate);

            // Remove the delete modal
            document.querySelector('.fixed.inset-0.bg-black\\/50').remove();

            if (action === 'all') {
                events = events.filter(e => e.id !== eventId);
                saveEventsToStorage();
                renderCalendar();
                closeDateModal();
                return;
            }

            if (action === 'specific') {
                if (deleteDate.getTime() === eventStart.getTime()) {
                    // Removing from start date - move start date forward
                    const newStartDate = new Date(deleteDate);
                    newStartDate.setDate(newStartDate.getDate() + 1);
                    event.startDate = newStartDate.toISOString().split('T')[0];
                } else if (deleteDate.getTime() === eventEnd.getTime()) {
                    // Removing from end date - move end date backward
                    const newEndDate = new Date(deleteDate);
                    newEndDate.setDate(newEndDate.getDate() - 1);
                    event.endDate = newEndDate.toISOString().split('T')[0];
                } else {
                    // Removing from middle - split the event into two parts
                    const originalEndDate = new Date(event.endDate);
                    
                    // First part: from original start to day before delete date
                    const firstPartEndDate = new Date(deleteDate);
                    firstPartEndDate.setDate(firstPartEndDate.getDate() - 1);
                    event.endDate = firstPartEndDate.toISOString().split('T')[0];
                    
                    // Second part: from day after delete date to original end
                    const secondPartStartDate = new Date(deleteDate);
                    secondPartStartDate.setDate(secondPartStartDate.getDate() + 1);
                    
                    const newId = Math.max(...events.map(e => e.id), 0) + 1;
                    events.push({
                        id: newId,
                        title: event.title,
                        description: event.description,
                        startDate: secondPartStartDate.toISOString().split('T')[0],
                        endDate: originalEndDate.toISOString().split('T')[0],
                        time: event.time,
                        category: event.category,
                        priority: event.priority,
                        color: event.color
                    });
                }
                saveEventsToStorage();
                renderCalendar();
                closeDateModal();
            }
        }

        function showEventDetails(eventId) {
            const event = events.find(e => e.id === eventId);
            if (!event) return;

            // Create event details modal
            const detailsModal = document.createElement('div');
            detailsModal.className = 'fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4';
            detailsModal.innerHTML = `
                <div class="glass-effect rounded-3xl p-8 w-full max-w-2xl mx-4 border border-white/20 slide-in">
                    <div class="flex items-center justify-between mb-6">
                        <h3 class="text-2xl font-bold text-gray-800 flex items-center">
                            ${getCategoryIcon(event.category)} <span class="ml-2">${event.title}</span>
                        </h3>
                        <button onclick="this.closest('.fixed').remove()" class="p-2 hover:bg-gray-100 rounded-xl transition-colors">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                            </svg>
                        </button>
                    </div>
                    
                    <div class="space-y-4">
                        <div class="flex items-center space-x-3">
                            <span class="text-sm px-3 py-1 ${event.color} text-white rounded-full font-medium">${event.category}</span>
                            <span class="text-sm px-3 py-1 ${event.priority === 'high' ? 'bg-red-100 text-red-800' : event.priority === 'medium' ? 'bg-yellow-100 text-yellow-800' : 'bg-green-100 text-green-800'} rounded-full font-medium">${event.priority} priority</span>
                        </div>
                        
                        ${event.description ? `<p class="text-gray-600 text-lg">${event.description}</p>` : ''}
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 p-4 bg-gray-50 rounded-xl">
                            <div class="flex items-center space-x-2">
                                <span class="text-lg">📅</span>
                                <div>
                                    <div class="font-medium text-gray-700">Date</div>
                                    <div class="text-gray-600">${new Date(event.startDate).toLocaleDateString('en-US', { 
                                        weekday: 'long', 
                                        year: 'numeric', 
                                        month: 'long', 
                                        day: 'numeric' 
                                    })}${event.endDate && event.endDate !== event.startDate ? ` - ${new Date(event.endDate).toLocaleDateString('en-US', { 
                                        weekday: 'long', 
                                        year: 'numeric', 
                                        month: 'long', 
                                        day: 'numeric' 
                                    })}` : ''}</div>
                                </div>
                            </div>
                            ${event.time ? `
                                <div class="flex items-center space-x-2">
                                    <span class="text-lg">⏰</span>
                                    <div>
                                        <div class="font-medium text-gray-700">Time</div>
                                        <div class="text-gray-600">${event.time}</div>
                                    </div>
                                </div>
                            ` : ''}
                        </div>
                        
                        <div class="flex space-x-3 pt-4">
                            <button onclick="editEvent(${event.id}); this.closest('.fixed').remove();" 
                                    class="flex-1 px-6 py-3 bg-blue-500 hover:bg-blue-600 text-white rounded-xl transition-all font-medium">
                                ✏️ Edit Event
                            </button>
                            <button onclick="deleteEventCompletely(${event.id}); this.closest('.fixed').remove();" 
                                    class="flex-1 px-6 py-3 bg-red-500 hover:bg-red-600 text-white rounded-xl transition-all font-medium">
                                🗑️ Delete Event
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(detailsModal);
        }

        function exportCalendar() {
            // Sort events by date
            const sortedEvents = [...events].sort((a, b) => new Date(a.startDate) - new Date(b.startDate));
            
            // Generate category statistics
            const categoryCount = {};
            events.forEach(event => {
                categoryCount[event.category] = (categoryCount[event.category] || 0) + 1;
            });
            
            // Create HTML content for export
            const htmlContent = `
                <!DOCTYPE html>
                <html>
                <head>
                    <title>RCICT Events & Training Schedule</title>
                    <style>
                        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
                        body { 
                            font-family: 'Inter', sans-serif; 
                            margin: 40px; 
                            color: #333; 
                            line-height: 1.6;
                        }
                        .header { 
                            text-align: center; 
                            margin-bottom: 40px; 
                            border-bottom: 3px solid #6366f1; 
                            padding-bottom: 20px;
                        }
                        .header h1 { 
                            color: #6366f1; 
                            font-size: 28px; 
                            margin: 0; 
                            font-weight: 700;
                        }
                        .header p { 
                            color: #666; 
                            margin: 10px 0 0 0; 
                            font-size: 14px;
                        }
                        .stats-grid { 
                            display: grid; 
                            grid-template-columns: repeat(4, 1fr); 
                            gap: 20px; 
                            margin-bottom: 40px;
                        }
                        .stat-card { 
                            background: #f8fafc; 
                            padding: 20px; 
                            border-radius: 12px; 
                            text-align: center; 
                            border: 1px solid #e2e8f0;
                        }
                        .stat-number { 
                            font-size: 24px; 
                            font-weight: 700; 
                            color: #6366f1; 
                            margin-bottom: 5px;
                        }
                        .stat-label { 
                            font-size: 12px; 
                            color: #666; 
                            text-transform: uppercase; 
                            letter-spacing: 0.5px;
                        }
                        .section { 
                            margin-bottom: 40px;
                        }
                        .section h2 { 
                            color: #374151; 
                            font-size: 20px; 
                            margin-bottom: 20px; 
                            font-weight: 600;
                            border-left: 4px solid #6366f1;
                            padding-left: 15px;
                        }
                        .event-item { 
                            background: white; 
                            border: 1px solid #e5e7eb; 
                            border-radius: 12px; 
                            padding: 20px; 
                            margin-bottom: 15px;
                            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
                        }
                        .event-header { 
                            display: flex; 
                            justify-content: space-between; 
                            align-items: flex-start; 
                            margin-bottom: 10px;
                        }
                        .event-title { 
                            font-size: 18px; 
                            font-weight: 600; 
                            color: #111827; 
                            margin: 0;
                        }
                        .event-priority { 
                            padding: 4px 12px; 
                            border-radius: 20px; 
                            font-size: 12px; 
                            font-weight: 500; 
                            text-transform: uppercase;
                        }
                        .priority-high { background: #fee2e2; color: #dc2626; }
                        .priority-medium { background: #fef3c7; color: #d97706; }
                        .priority-low { background: #dcfce7; color: #16a34a; }
                        .event-meta { 
                            display: flex; 
                            gap: 20px; 
                            margin-bottom: 10px; 
                            font-size: 14px; 
                            color: #6b7280;
                        }
                        .event-description { 
                            color: #4b5563; 
                            font-size: 14px; 
                            margin-top: 10px;
                        }
                        .category-item { 
                            display: flex; 
                            justify-content: space-between; 
                            padding: 12px; 
                            background: #f9fafb; 
                            border-radius: 8px; 
                            margin-bottom: 8px;
                            border: 1px solid #e5e7eb;
                        }
                        .category-name { 
                            font-weight: 500; 
                            text-transform: capitalize;
                        }
                        .category-count { 
                            background: #6366f1; 
                            color: white; 
                            padding: 2px 8px; 
                            border-radius: 12px; 
                            font-size: 12px; 
                            font-weight: 600;
                        }
                        .no-events { 
                            text-align: center; 
                            color: #9ca3af; 
                            font-style: italic; 
                            padding: 40px;
                        }
                        @media print {
                            body { margin: 20px; }
                            .event-item { break-inside: avoid; }
                        }
                    </style>
                </head>
                <body>
                    <div class="header">
                        <h1>RCICT Events & Training Schedule</h1>
                        <p>Generated on ${new Date().toLocaleDateString('en-US', { 
                            weekday: 'long', 
                            year: 'numeric', 
                            month: 'long', 
                            day: 'numeric' 
                        })}</p>
                    </div>

                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-number">${events.length}</div>
                            <div class="stat-label">Total Events</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">${events.filter(e => e.priority === 'high').length}</div>
                            <div class="stat-label">High Priority</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">${events.filter(e => e.priority === 'medium').length}</div>
                            <div class="stat-label">Medium Priority</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">${events.filter(e => e.priority === 'low').length}</div>
                            <div class="stat-label">Low Priority</div>
                        </div>
                    </div>

                    <div class="section">
                        <h2>📅 Scheduled Events</h2>
                        ${sortedEvents.length === 0 ? 
                            '<div class="no-events">No events scheduled at this time.</div>' :
                            sortedEvents.map(event => {
                                const startDate = new Date(event.startDate);
                                const endDate = event.endDate ? new Date(event.endDate) : null;
                                
                                let dateDisplay;
                                if (endDate && endDate.getTime() !== startDate.getTime()) {
                                    dateDisplay = `${startDate.toLocaleDateString()} - ${endDate.toLocaleDateString()}`;
                                } else {
                                    dateDisplay = startDate.toLocaleDateString('en-US', { 
                                        weekday: 'long', 
                                        year: 'numeric', 
                                        month: 'long', 
                                        day: 'numeric' 
                                    });
                                }
                                
                                return `
                                    <div class="event-item">
                                        <div class="event-header">
                                            <h3 class="event-title">${event.title}</h3>
                                            <span class="event-priority priority-${event.priority}">${event.priority}</span>
                                        </div>
                                        <div class="event-meta">
                                            <span>📅 ${dateDisplay}</span>
                                            ${event.time ? `<span>⏰ ${event.time}</span>` : ''}
                                            <span>🏷️ ${event.category.charAt(0).toUpperCase() + event.category.slice(1)}</span>
                                        </div>
                                        ${event.description ? `<div class="event-description">${event.description}</div>` : ''}
                                    </div>
                                `;
                            }).join('')
                        }
                    </div>

                    <div class="section">
                        <h2>📊 Event Categories</h2>
                        ${Object.entries(categoryCount).length === 0 ? 
                            '<div class="no-events">No categories available.</div>' :
                            Object.entries(categoryCount).map(([category, count]) => `
                                <div class="category-item">
                                    <span class="category-name">${category}</span>
                                    <span class="category-count">${count}</span>
                                </div>
                            `).join('')
                        }
                    </div>
                </body>
                </html>
            `;
            
            // Create and download the file
            const blob = new Blob([htmlContent], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `RCICT_Events_Schedule_${new Date().toISOString().split('T')[0]}.html`;
            
            // Trigger download
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            // Clean up
            URL.revokeObjectURL(url);
            
            // Show success feedback
            const button = document.querySelector('[onclick="exportCalendar()"]');
            const originalText = button.textContent;
            const originalClass = button.className;
            
            button.textContent = '✅ Downloaded!';
            button.className = 'w-full p-3 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-xl transition-all';
            
            setTimeout(() => {
                button.textContent = originalText;
                button.className = originalClass;
            }, 3000);
        }

        function editEvent(eventId) {
            const event = events.find(e => e.id === eventId);
            if (!event) return;
            
            // Pre-fill the modal with event data
            document.getElementById('eventTitle').value = event.title;
            document.getElementById('eventDescription').value = event.description || '';
            document.getElementById('eventStartDate').value = event.startDate;
            document.getElementById('eventEndDate').value = event.endDate || '';
            document.getElementById('eventTime').value = event.time || '';
            document.getElementById('eventCategory').value = event.category;
            document.getElementById('eventPriority').value = event.priority;
            selectedColor = event.color;
            
            // Update color selection visual
            document.querySelectorAll('[onclick^="selectColor"]').forEach(btn => {
                btn.classList.remove('border-gray-800', 'scale-110');
                btn.classList.add('border-transparent');
                if (btn.classList.contains(event.color.replace('bg-', ''))) {
                    btn.classList.remove('border-transparent');
                    btn.classList.add('border-gray-800', 'scale-110');
                }
            });
            
            // Change modal title and form action
            document.querySelector('#addEventModal h3').innerHTML = '✏️ <span class="ml-2">Edit Event</span>';
            document.querySelector('#addEventModal form').onsubmit = function(e) {
                e.preventDefault();
                updateEvent(eventId);
            };
            document.querySelector('#addEventModal button[type="submit"]').textContent = 'Update Event';
            
            openAddEventModal();
        }

        function updateEvent(eventId) {
            const eventIndex = events.findIndex(e => e.id === eventId);
            if (eventIndex === -1) return;
            
            events[eventIndex] = {
                ...events[eventIndex],
                title: document.getElementById('eventTitle').value,
                description: document.getElementById('eventDescription').value,
                startDate: document.getElementById('eventStartDate').value,
                endDate: document.getElementById('eventEndDate').value,
                time: document.getElementById('eventTime').value,
                category: document.getElementById('eventCategory').value,
                priority: document.getElementById('eventPriority').value,
                color: selectedColor
            };
            
            saveEventsToStorage(); // Auto-save
            renderCalendar();
            closeAddEventModal();
            
            // Reset modal for next use
            resetModalForAdd();
        }

        function resetModalForAdd() {
            const modalTitle = document.querySelector('#addEventModal h3');
            const modalForm = document.querySelector('#addEventModal form');
            const submitButton = document.querySelector('#addEventModal button[type="submit"]');
            
            if (modalTitle) {
                modalTitle.innerHTML = '✨ <span class="ml-2">Create New Event</span>';
            }
            if (modalForm) {
                modalForm.onsubmit = addEvent;
            }
            if (submitButton) {
                submitButton.textContent = 'Create Event';
            }
            
            // Reset selected color
            selectedColor = 'bg-blue-500';
            
            // Reset color selection visual
            document.querySelectorAll('[onclick^="selectColor"]').forEach(btn => {
                btn.classList.remove('border-gray-800', 'scale-110');
                btn.classList.add('border-transparent');
            });
            
            // Select blue as default
            const blueButton = document.querySelector('[onclick="selectColor(\'bg-blue-500\')"]');
            if (blueButton) {
                blueButton.classList.remove('border-transparent');
                blueButton.classList.add('border-gray-800', 'scale-110');
            }
        }

        let currentView = 'calendar';

        function toggleToListView() {
            currentView = 'list';
            showListView();
            updateViewButtons();
        }

        function toggleToCalendarView() {
            currentView = 'calendar';
            showCalendarView();
            updateViewButtons();
        }

        function updateViewButtons() {
            const listButton = document.querySelector('[onclick="toggleToListView()"]');
            const calendarButton = document.querySelector('[onclick="toggleToCalendarView()"]');
            
            if (currentView === 'list') {
                listButton.className = 'w-full p-3 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-xl hover:from-green-600 hover:to-emerald-700 transition-all';
                calendarButton.className = 'w-full p-3 bg-gradient-to-r from-gray-400 to-gray-500 text-white rounded-xl hover:from-gray-500 hover:to-gray-600 transition-all';
            } else {
                listButton.className = 'w-full p-3 bg-gradient-to-r from-gray-400 to-gray-500 text-white rounded-xl hover:from-gray-500 hover:to-gray-600 transition-all';
                calendarButton.className = 'w-full p-3 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-xl hover:from-green-600 hover:to-emerald-700 transition-all';
            }
        }

        function showCalendarView() {
            const calendarContainer = document.querySelector('.xl\\:col-span-3 .glass-effect');
            
            // Restore original calendar structure
            calendarContainer.innerHTML = `
                <!-- Days of week header -->
                <div class="grid grid-cols-7 gap-2 mb-6">
                    <div class="text-center font-bold text-gray-700 py-3 bg-gradient-to-r from-indigo-50 to-purple-50 rounded-xl">Sun</div>
                    <div class="text-center font-bold text-gray-700 py-3 bg-gradient-to-r from-indigo-50 to-purple-50 rounded-xl">Mon</div>
                    <div class="text-center font-bold text-gray-700 py-3 bg-gradient-to-r from-indigo-50 to-purple-50 rounded-xl">Tue</div>
                    <div class="text-center font-bold text-gray-700 py-3 bg-gradient-to-r from-indigo-50 to-purple-50 rounded-xl">Wed</div>
                    <div class="text-center font-bold text-gray-700 py-3 bg-gradient-to-r from-indigo-50 to-purple-50 rounded-xl">Thu</div>
                    <div class="text-center font-bold text-gray-700 py-3 bg-gradient-to-r from-indigo-50 to-purple-50 rounded-xl">Fri</div>
                    <div class="text-center font-bold text-gray-700 py-3 bg-gradient-to-r from-indigo-50 to-purple-50 rounded-xl">Sat</div>
                </div>
                
                <!-- Calendar grid -->
                <div id="calendarGrid" class="grid grid-cols-7 gap-3">
                    <!-- Calendar days will be generated here -->
                </div>
            `;
            
            saveEventsToStorage(); // Auto-save
            renderCalendar();
        }

        function showListView() {
            const calendarContainer = document.querySelector('.xl\\:col-span-3 .glass-effect');
            
            // Create list view
            const year = currentDate.getFullYear();
            const month = currentDate.getMonth();
            const monthNames = ["January", "February", "March", "April", "May", "June",
                "July", "August", "September", "October", "November", "December"];
            
            const monthEvents = events.filter(event => {
                const eventDate = new Date(event.startDate);
                return eventDate.getMonth() === month && eventDate.getFullYear() === year;
            }).sort((a, b) => new Date(a.startDate + ' ' + (a.time || '00:00')) - new Date(b.startDate + ' ' + (b.time || '00:00')));

            calendarContainer.innerHTML = `
                <div class="p-6">
                    <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                        📋 <span class="ml-2">${monthNames[month]} ${year} - List View</span>
                    </h2>
                    
                    ${monthEvents.length === 0 ? 
                        '<div class="text-center py-12"><div class="text-6xl mb-4">📭</div><p class="text-xl text-gray-500">No events this month</p><button onclick="openAddEventModal()" class="mt-4 px-6 py-3 gradient-bg text-white rounded-xl font-medium">Add Your First Event</button></div>' :
                        `<div class="space-y-4">
                            ${monthEvents.map(event => {
                                const eventDate = new Date(event.startDate);
                                const endDate = event.endDate ? new Date(event.endDate) : null;
                                const dayName = eventDate.toLocaleDateString('en-US', { weekday: 'long' });
                                const dateDisplay = eventDate.toLocaleDateString('en-US', { month: 'long', day: 'numeric' });
                                
                                let fullDateDisplay;
                                if (endDate && endDate.getTime() !== eventDate.getTime()) {
                                    const endDateDisplay = endDate.toLocaleDateString('en-US', { month: 'long', day: 'numeric' });
                                    fullDateDisplay = `${dateDisplay} - ${endDateDisplay}`;
                                } else {
                                    fullDateDisplay = `${dayName}, ${dateDisplay}`;
                                }
                                
                                return `
                                    <div class="group p-6 bg-white/80 rounded-2xl border-2 border-gray-200 hover:border-indigo-300 hover:shadow-lg transition-all ${getPriorityColor(event.priority)}">
                                        <div class="flex items-start justify-between">
                                            <div class="flex-1">
                                                <div class="flex items-center space-x-3 mb-3">
                                                    <span class="text-2xl">${getCategoryIcon(event.category)}</span>
                                                    <div>
                                                        <h3 class="text-xl font-bold text-gray-800">${event.title}</h3>
                                                        <div class="flex items-center space-x-2 mt-1">
                                                            <span class="text-sm px-3 py-1 ${event.color} text-white rounded-full font-medium">${event.category}</span>
                                                            <span class="text-sm px-3 py-1 ${event.priority === 'high' ? 'bg-red-100 text-red-800' : event.priority === 'medium' ? 'bg-yellow-100 text-yellow-800' : 'bg-green-100 text-green-800'} rounded-full font-medium">${event.priority} priority</span>
                                                        </div>
                                                    </div>
                                                </div>
                                                
                                                ${event.description ? `<p class="text-gray-600 mb-3 text-lg">${event.description}</p>` : ''}
                                                
                                                <div class="flex items-center space-x-4 text-gray-500">
                                                    <div class="flex items-center space-x-2">
                                                        <span class="text-lg">📅</span>
                                                        <span class="font-medium">${fullDateDisplay}</span>
                                                    </div>
                                                    ${event.time ? `
                                                        <div class="flex items-center space-x-2">
                                                            <span class="text-lg">⏰</span>
                                                            <span class="font-medium">${event.time}</span>
                                                        </div>
                                                    ` : ''}
                                                </div>
                                            </div>
                                            
                                            <div class="flex space-x-2 opacity-0 group-hover:opacity-100 transition-opacity">
                                                <button onclick="editEvent(${event.id})" class="p-3 bg-blue-100 text-blue-600 rounded-xl hover:bg-blue-200 transition-colors" title="Edit Event">
                                                    ✏️
                                                </button>
                                                <button onclick="deleteEventCompletely(${event.id})" class="p-3 bg-red-100 text-red-600 rounded-xl hover:bg-red-200 transition-colors" title="Delete Event">
                                                    🗑️
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                `;
                            }).join('')}
                        </div>`
                    }
                </div>
            `;
        }

        // Keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            if (e.key === 'n' || e.key === 'N') {
                if (!document.getElementById('addEventModal').classList.contains('hidden')) return;
                openAddEventModal();
            }
            if (e.key === 't' || e.key === 'T') {
                goToToday();
            }
            if (e.key === 'Escape') {
                if (!document.getElementById('dateModal').classList.contains('hidden')) {
                    closeDateModal();
                } else {
                    closeAddEventModal();
                }
            }
        });

        // Initialize calendar
        renderCalendar();
        updateViewButtons();
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'96ee769ed65d6792',t:'MTc1NTE1MzY1NC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
